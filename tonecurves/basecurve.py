import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import CubicSpline


class BaseCurve(object):
    def __init__(self):
        Nikon_D750 =   [[0.000000, 0.000000],
                        [0.018124, 0.026126],
                        [0.143357, 0.370145],
                        [0.330116, 0.730507],
                        [0.457952, 0.853462],
                        [0.734950, 0.965061],
                        [0.904758, 0.985699],
                        [1.000000, 1.000000]]
        self.Nikon_D750 = np.array(Nikon_D750)

        Nikon_D5100 =  [[0.000000, 0.000000],
                        [0.001113, 0.000506],
                        [0.002842, 0.001338],
                        [0.005461, 0.002470],
                        [0.011381, 0.006099],
                        [0.013303, 0.007758],
                        [0.034638, 0.041119],
                        [0.044441, 0.063882],
                        [0.070338, 0.139639],
                        [0.096068, 0.210915],
                        [0.137693, 0.310295],
                        [0.206041, 0.432674],
                        [0.255508, 0.504447],
                        [0.302770, 0.569576],
                        [0.425625, 0.726755],
                        [0.554526, 0.839541],
                        [0.621216, 0.882839],
                        [0.702662, 0.927072],
                        [0.897426, 0.990984],
                        [1.000000, 1.000000]]
        self.Nikon_D5100 = np.array(Nikon_D5100)

        Nikon_D7000 =  [[0.000000, 0.000000],
                        [0.001943, 0.003040],
                        [0.019814, 0.028810],
                        [0.080784, 0.210476],
                        [0.145700, 0.383873],
                        [0.295961, 0.654041],
                        [0.651915, 0.952819],
                        [1.000000, 1.000000]]
        self.Nikon_D7000 = np.array(Nikon_D7000)

        Nikon_D7200 =  [[0.000000, 0.000000],
                        [0.001604, 0.001334],
                        [0.007401, 0.005237],
                        [0.009474, 0.006890],
                        [0.017348, 0.017176],
                        [0.032782, 0.044336],
                        [0.048033, 0.086548],
                        [0.075803, 0.168331],
                        [0.109539, 0.273539],
                        [0.137373, 0.364645],
                        [0.231651, 0.597511],
                        [0.323797, 0.736475],
                        [0.383796, 0.805797],
                        [0.462284, 0.872247],
                        [0.549844, 0.918328],
                        [0.678855, 0.962361],
                        [0.817445, 0.990406],
                        [1.000000, 1.000000]]
        self.Nikon_D7200 = np.array(Nikon_D7200)

        Nikon_D7500 =  [[0.000000, 0.000000],
                        [0.000892, 0.001062],
                        [0.002280, 0.001768],
                        [0.013983, 0.011368],
                        [0.032597, 0.044700],
                        [0.050065, 0.097131],
                        [0.084129, 0.219954],
                        [0.120975, 0.336806],
                        [0.170730, 0.473752],
                        [0.258677, 0.647113],
                        [0.409997, 0.827417],
                        [0.499979, 0.889468],
                        [0.615564, 0.941960],
                        [0.665272, 0.957736],
                        [0.832126, 0.991968],
                        [1.000000, 1.000000]]
        self.Nikon_D7500 = np.array(Nikon_D7500)

        Sony_RX100 =   [[0.000000, 0.000000],
                        [0.015106, 0.008116],
                        [0.070077, 0.093725],
                        [0.107484, 0.170723],
                        [0.191528, 0.341093],
                        [0.257996, 0.458453],
                        [0.305381, 0.537267],
                        [0.326367, 0.569257],
                        [0.448067, 0.723742],
                        [0.509627, 0.777966],
                        [0.676751, 0.898797],
                        [1.000000, 1.000000]]
        self.Sony_RX100 = np.array(Sony_RX100)

        Canon_6D =     [[0.000000, 0.002917],
                        [0.000751, 0.001716],
                        [0.006011, 0.004438],
                        [0.020286, 0.021725],
                        [0.048084, 0.085918],
                        [0.093914, 0.233804],
                        [0.162284, 0.431375],
                        [0.257701, 0.629218],
                        [0.384673, 0.800332],
                        [0.547709, 0.917761],
                        [0.751315, 0.988132],
                        [1.000000, 0.999943]]
        self.Canon_6D = np.array(Canon_6D)

        Fujifilm_X100 =   [[0.000000, 0.000000],
                           [0.009145, 0.007905],
                           [0.026570, 0.032201],
                           [0.131526, 0.289717],
                           [0.175858, 0.395263],
                           [0.350981, 0.696899],
                           [0.614997, 0.959451],
                           [1.000000, 1.000000]]
        self.Fujifilm_X100 = np.array(Fujifilm_X100)

        Canon_5D_II = [[0.000000, 0.000366],
                       [0.006560, 0.003504],
                       [0.027310, 0.029834],
                       [0.045915, 0.070230],
                       [0.206554, 0.539895],
                       [0.442337, 0.872409],
                       [0.673263, 0.971703],
                       [1.000000, 0.999832]]
        self.Canon_5D_II = np.array(Canon_5D_II)

        Pentax_K5 =    [[0.000000, 0.000000],
                        [0.004754, 0.002208],
                        [0.009529, 0.004214],
                        [0.023713, 0.013508],
                        [0.031866, 0.020352],
                        [0.046734, 0.034063],
                        [0.059989, 0.052413],
                        [0.088415, 0.096030],
                        [0.136610, 0.190629],
                        [0.174480, 0.256484],
                        [0.205192, 0.307430],
                        [0.228896, 0.348447],
                        [0.286411, 0.428680],
                        [0.355314, 0.513527],
                        [0.440014, 0.607651],
                        [0.567096, 0.732791],
                        [0.620597, 0.775968],
                        [0.760355, 0.881828],
                        [0.875139, 0.960682],
                        [1.000000, 1.000000]]
        self.Pentax_K5 = np.array(Pentax_K5)

        Unknown =  [[0.000000, 0.000000],
                    [0.015520, 0.012248],
                    [0.097950, 0.251013],
                    [0.301515, 0.621951],
                    [0.415513, 0.771384],
                    [0.547326, 0.843079],
                    [0.819769, 0.956678],
                    [1.000000, 1.000000]]
        self.Unknown = np.array(Unknown)


        Nikon_D90 =    [[0.000000, 0.000000],
                        [0.011702, 0.012659],
                        [0.122918, 0.289973],
                        [0.153642, 0.342731],
                        [0.246855, 0.510114],
                        [0.448958, 0.733820],
                        [0.666759, 0.894290],
                        [1.000000, 1.000000]]
        self.Nikon_D90 = np.array(Nikon_D90)

        Nikon_D800 =   [[0.000000, 0.000000],
                        [0.001773, 0.001936],
                        [0.009671, 0.009693],
                        [0.016754, 0.020617],
                        [0.024884, 0.037309],
                        [0.048174, 0.107768],
                        [0.056932, 0.139532],
                        [0.085504, 0.233303],
                        [0.130378, 0.349747],
                        [0.155476, 0.405445],
                        [0.175245, 0.445918],
                        [0.217657, 0.516873],
                        [0.308475, 0.668608],
                        [0.375381, 0.754058],
                        [0.459858, 0.839909],
                        [0.509567, 0.881543],
                        [0.654394, 0.960877],
                        [0.783380, 0.999161],
                        [0.859310, 1.000000],
                        [1.000000, 1.000000]]
        self.Nikon_D800 = np.array(Nikon_D800)

        Olympus_M10_II =   [[0.000000, 0.000000],
                            [0.005707, 0.004764],
                            [0.018944, 0.024456],
                            [0.054501, 0.129992],
                            [0.075665, 0.211873],
                            [0.119641, 0.365771],
                            [0.173148, 0.532024],
                            [0.247979, 0.668989],
                            [0.357597, 0.780138],
                            [0.459003, 0.839829],
                            [0.626844, 0.904426],
                            [0.769425, 0.948541],
                            [0.820429, 0.964715],
                            [1.000000, 1.000000]]
        self.Olympus_M10_II = np.array(Olympus_M10_II)

        # Put them all in a list 
        self.camera_curves = [self.Canon_5D_II, self.Nikon_D800, self.Nikon_D750, self.Sony_RX100, self.Pentax_K5, self.Fujifilm_X100, self.Olympus_M10_II]
        self.scene_calibration = [2.0804970721357585, 2.6232881824658407, 2.2355459178985195, 1.6082906021398837, 1.3727694384372147, 1.9841671439065884, 2.669986682109634]

    def get_average_curve(self, x):
        camera_display_sum = np.zeros_like(x)
        for ii, camera in enumerate(self.camera_curves):
            camera_cubic_spline = CubicSpline(camera[:, 0], camera[:, 1], bc_type="clamped")
            x_adjusted = x / self.scene_calibration[ii]
            camera_display_sum += camera_cubic_spline(np.clip(x_adjusted, 0.0, 1.0))

        camera_display = camera_display_sum / len(self.camera_curves)
        camera_dy = np.zeros_like(x)
        camera_dy[1:] = (camera_display[:-1] - camera_display[1:]) / (x[:-1] - x[1:])

        return camera_display
